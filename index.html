<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>入居のしおり｜ユニヴ・ライフ株式会社</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description"
content="ユニヴ・ライフ株式会社が管理する賃貸物件の入居者様向け公式入居のしおり（Web）です。" />
<link rel="canonical" href="https://guide.univ-life.com/" />

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
.richtext p{margin-bottom:.6rem;}
.richtext a{text-decoration:underline;}
</style>
</head>

<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col">

<header class="bg-white shadow-sm sticky top-0 z-20">
<div class="max-w-4xl mx-auto px-4 py-3">
<h1 id="propertyTitle" class="text-base font-semibold">
入居のしおり
</h1>
</div>
</header>

<main class="flex-1">
<div class="max-w-4xl mx-auto px-4 py-6 space-y-6">

<section id="propertyMetaSection"
class="bg-white rounded-2xl shadow-sm border p-4">
<p id="propertyMeta" class="text-xs text-slate-400">
情報を取得中
</p>
</section>

<section>
<div id="tabNav" class="flex flex-wrap gap-2 text-xs"></div>
<div id="tabPanels" class="mt-3 space-y-4"></div>
</section>

</div>
</main>

<!-- Lightbox -->
<div id="lightbox"
class="fixed inset-0 bg-black/90 hidden items-center justify-center z-50">

<button id="lightboxClose"
class="absolute top-4 right-4 text-white text-2xl">
✕
</button>

<img id="lightboxImage"
class="max-h-[90vh] max-w-[95vw] object-contain select-none" />
</div>

<footer class="border-t bg-white text-xs text-slate-400">
<div class="max-w-4xl mx-auto px-4 py-3">
© ユニヴ・ライフ株式会社
</div>
</footer>

<script type="module">

import { initializeApp } from
"https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";

import {
getFirestore,
doc,
getDoc,
collection,
getDocs
} from
"https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
apiKey: "YOUR_API_KEY",
authDomain: "univlife-kanri.firebaseapp.com",
projectId: "univlife-kanri"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

function escapeHtml(str){
return (str||"")
.replace(/&/g,"&amp;")
.replace(/</g,"&lt;")
.replace(/>/g,"&gt;");
}

function renderText(text){
if(!text) return "";
let t = escapeHtml(text);
t = t.replace(/\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g,
`<a href="$2" target="_blank">$1</a>`);
return t.replace(/\n/g,"<br>");
}

async function loadSections(){
const snap = await getDocs(collection(db,"sections_master"));
const map = {};
snap.forEach(d=>map[d.id]=d.data());
return map;
}

async function loadGuides(){
const snap = await getDocs(collection(db,"guides_master_raw"));
const list=[];
snap.forEach(d=>{
const data=d.data();
list.push({
section_key:data.section_key,
variant_key:data.variant_key||"base",
body_text:data.body_text||"",
image_urls:Array.isArray(data.image_urls)?data.image_urls:[]
});
});
return list;
}

function pickContent(list,key){
return list.find(x=>x.section_key===key);
}

function renderSections(masterMap,guides){

const nav=document.getElementById("tabNav");
const panels=document.getElementById("tabPanels");

nav.innerHTML="";
panels.innerHTML="";

Object.keys(masterMap).forEach((key,i)=>{

const master=masterMap[key];
const content=pickContent(guides,key);
if(!content||!content.body_text) return;

const btn=document.createElement("button");
btn.className="px-3 py-1 rounded-full border bg-slate-100";
btn.textContent=master.label_ja||key;
btn.onclick=()=>{
document.querySelectorAll(".panel").forEach(p=>p.classList.add("hidden"));
document.getElementById("panel-"+key).classList.remove("hidden");
};
nav.appendChild(btn);

const panel=document.createElement("div");
panel.id="panel-"+key;
panel.className="panel hidden bg-white p-4 rounded-2xl shadow-sm";

panel.innerHTML=`
<div class="richtext text-sm">
${renderText(content.body_text)}
</div>

${
content.image_urls.length
?`
<div class="mt-4 grid gap-3">
${content.image_urls.map((url,i)=>`
<img src="${url}"
data-lightbox-group="${key}"
data-lightbox-index="${i}"
class="rounded-lg cursor-zoom-in"/>
`).join("")}
</div>
`
:""
}
`;

panels.appendChild(panel);

if(i===0) panel.classList.remove("hidden");

});

}

async function main(){
const master=await loadSections();
const guides=await loadGuides();
renderSections(master,guides);
}

main();

</script>

<script>

/* Lightbox */

let currentImages=[];
let currentIndex=0;
let startX=0;

const lightbox=document.getElementById("lightbox");
const lightboxImage=document.getElementById("lightboxImage");

document.addEventListener("click",(e)=>{
const img=e.target.closest("img[data-lightbox-index]");
if(!img) return;

const group=img.dataset.lightboxGroup;
const imgs=[...document.querySelectorAll(
`img[data-lightbox-group="${group}"]`
)];

currentImages=imgs.map(x=>x.src);
currentIndex=Number(img.dataset.lightboxIndex);

openLightbox();
});

function openLightbox(){
lightbox.classList.remove("hidden");
lightbox.classList.add("flex");
updateImage();
}

function updateImage(){
lightboxImage.src=currentImages[currentIndex];
}

function closeLightbox(){
lightbox.classList.add("hidden");
lightbox.classList.remove("flex");
}

document.getElementById("lightboxClose")
.addEventListener("click",closeLightbox);

lightbox.addEventListener("click",(e)=>{
if(e.target===lightbox) closeLightbox();
});

lightbox.addEventListener("touchstart",(e)=>{
startX=e.touches[0].clientX;
});

lightbox.addEventListener("touchend",(e)=>{
const diff=e.changedTouches[0].clientX-startX;
if(Math.abs(diff)<50) return;

if(diff<0)
currentIndex=(currentIndex+1)%currentImages.length;
else
currentIndex=(currentIndex-1+currentImages.length)%currentImages.length;

updateImage();
});

</script>

</body>
</html>