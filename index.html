<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>入居のしおり | guide.univ-life.com</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-white shadow-sm sticky top-0 z-10">
    <div class="max-w-3xl mx-auto px-4 py-3 flex items-center justify-between">
      <div>
        <h1 id="propertyTitle" class="text-lg font-semibold text-slate-800">
          物件名を読み込み中…
        </h1>
        <p id="propertyMeta" class="text-xs text-slate-500"></p>
      </div>
      <span class="text-xs px-2 py-1 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-100">
        入居のしおり
      </span>
    </div>
  </header>

  <!-- Main -->
  <main class="flex-1">
    <div class="max-w-3xl mx-auto px-4 py-6">
      <!-- お知らせ -->
      <div id="notice" class="mb-4 hidden">
        <p class="text-sm text-amber-700 bg-amber-50 border border-amber-100 rounded-md px-3 py-2">
          この物件の「入居のしおり」は現在公開されていません。
        </p>
      </div>

      <!-- セクション一覧 -->
      <div id="sectionsContainer" class="space-y-4">
        <!-- JS で差し込み -->
      </div>

      <p class="mt-8 text-[11px] text-slate-400 text-right">
        ※ 記載内容は予告なく変更される場合があります。
      </p>
    </div>
  </main>

  <script>
    // ★ 仮データ：あとで Firestore / Storyblok / JSON API から取得する想定
    const propertyData = {
      doc_id: "10100",
      propertyNo: "10100",
      canonicalName: "尚志ハウス",
      address: "大阪府大阪市城東区野江4-4-3",
      shiori_enabled: true,
      shiori_slug: "10100",

      // セクション公開フラグ
      key: true,
      mailbox: true,
      delivery_box: false,
      bicycle_space: true,
      room_equipment: true,
      special_note: false,
      moving: true,
      electricity: true,
      gas: true,
      water: true,
      internet: true,
      trash: true,
      common_area: true,
      pets: true,
      toilet: true,
      noise: true,
      drainage: true,
      ventilation: true,
      heater: true,
      bike_parking: true,
      car_parking: true,
      sales: true,
      expenses: true,
      cancellation: true,
    };

    // セクション定義：列名 ↔ 表示タイトル の対応
    const SECTION_DEFS = [
      { key: "key",            title: "鍵" },
      { key: "mailbox",        title: "メールBOX" },
      { key: "delivery_box",   title: "宅配ボックス" },
      { key: "bicycle_space",  title: "自転車区画" },
      { key: "room_equipment", title: "室内設備" },
      { key: "moving",         title: "引っ越し" },
      { key: "electricity",    title: "電気" },
      { key: "gas",            title: "ガス" },
      { key: "water",          title: "水道" },
      { key: "internet",       title: "インターネット" },
      { key: "trash",          title: "ゴミ" },
      { key: "common_area",    title: "共用部の使用" },
      { key: "pets",           title: "ペットの飼育" },
      { key: "toilet",         title: "トイレの使用" },
      { key: "noise",          title: "騒音" },
      { key: "drainage",       title: "排水" },
      { key: "ventilation",    title: "換気" },
      { key: "heater",         title: "暖房器具" },
      { key: "bike_parking",   title: "駐輪場" },
      { key: "car_parking",    title: "駐車場" },
      { key: "sales",          title: "訪問販売" },
      { key: "expenses",       title: "入居中の費用負担" },
      { key: "cancellation",   title: "解約" },
      // special_note は最後に別扱いでもOK
    ];

    function getPropertyNoFromQuery() {
      const params = new URLSearchParams(window.location.search);
      return params.get("propertyNo"); // 例: ?propertyNo=10100
    }

    function init() {
      const propertyNo = getPropertyNoFromQuery();
      // 本来は propertyNo を使って API から propertyData を取得する
      // ここでは 10100 固定データなのでチェックだけ
      if (propertyNo && propertyNo !== propertyData.propertyNo) {
        console.warn("クエリの propertyNo とデータが一致していません");
      }

      // ヘッダ部表示
      document.getElementById("propertyTitle").textContent = propertyData.canonicalName || propertyData.propertyNo;
      document.getElementById("propertyMeta").textContent =
        `物件No: ${propertyData.propertyNo} ／ ${propertyData.address}`;

      // 公開フラグ OFF の場合
      if (!propertyData.shiori_enabled) {
        document.getElementById("notice").classList.remove("hidden");
        return;
      }

      renderSections(propertyData);
    }

    function renderSections(data) {
      const container = document.getElementById("sectionsContainer");
      container.innerHTML = "";

      SECTION_DEFS.forEach(section => {
        if (!data[section.key]) return; // FALSE のセクションは非表示

        const sec = document.createElement("section");
        sec.className = "bg-white rounded-xl shadow-sm border border-slate-100 px-4 py-3";
        sec.id = section.key;

        sec.innerHTML = `
          <h2 class="text-base font-semibold text-slate-800 mb-1">${section.title}</h2>
          <div class="text-sm text-slate-700 leading-relaxed" id="body-${section.key}">
            <!-- ここに本文を入れる（Storyblok やマスタ文章から） -->
            この項目の説明文は現在準備中です。
          </div>
        `;

        container.appendChild(sec);
      });

      // 特記事項（special_note）があれば最後に表示
      if (data.special_note) {
        const sec = document.createElement("section");
        sec.className = "bg-amber-50 rounded-xl border border-amber-100 px-4 py-3";
        sec.id = "special_note";
        sec.innerHTML = `
          <h2 class="text-base font-semibold text-amber-800 mb-1">特記事項</h2>
          <div class="text-sm text-amber-900 leading-relaxed">
            ${data.special_note}
          </div>
        `;
        container.appendChild(sec);
      }
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
