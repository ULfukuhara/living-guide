<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>入居のしおり｜ユニヴ・ライフ株式会社</title>

  <meta name="description" content="ユニヴ・ライフ株式会社 管理物件の入居のしおりWebページです。" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col">

<header class="bg-white shadow-sm sticky top-0 z-20">
  <div class="max-w-4xl mx-auto px-4 py-3 flex items-center gap-2">
    <span class="inline-flex items-center justify-center w-7 h-7 rounded-full bg-emerald-100 text-emerald-700 text-xs font-bold">UL</span>
    <h1 id="propertyTitle" class="text-base font-semibold text-slate-800">
      入居のしおり
    </h1>
  </div>
</header>

<main class="flex-1">
  <div class="max-w-4xl mx-auto px-4 pt-6 pb-12 space-y-6">

    <section id="propertyMetaSection" class="hidden bg-white rounded-2xl shadow-sm border border-slate-100 p-4">
      <h2 class="text-base font-semibold mb-2">入居のしおり</h2>
      <p id="propertyMeta" class="text-sm text-slate-500"></p>
    </section>

    <section id="contentArea"></section>

  </div>
</main>

<footer class="border-t border-slate-200 bg-white">
  <div class="max-w-4xl mx-auto px-4 py-3 text-[11px] text-slate-400 flex justify-between">
    <p>© ユニヴ・ライフ株式会社</p>
    <a href="/list.html" class="text-slate-300 hover:text-slate-400">
      入居のしおり一覧
    </a>
  </div>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "YOUR_KEY",
  authDomain: "YOUR_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const url = new URL(window.location.href);
let propertyNo = url.searchParams.get("propertyNo");
const token = url.searchParams.get("token");
const contentArea = document.getElementById("contentArea");

if (!propertyNo && !token) {
  document.getElementById("propertyTitle").textContent = "入居者専用ページ";
  document.title = "入居者専用ページ｜ユニヴ・ライフ株式会社";

  contentArea.innerHTML = `
    <section class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
      <p class="text-sm text-slate-700">
        このページは入居者専用ページです。<br />
        鍵渡し書類のQRコード／URLからアクセスしてください。
      </p>
    </section>
  `;
  return;
}

if (token) {
  let robots = document.createElement("meta");
  robots.name = "robots";
  robots.content = "noindex,nofollow";
  document.head.appendChild(robots);
}

if (propertyNo) {
  const ref = doc(db, "properties_shiori", propertyNo);
  const snap = await getDoc(ref);

  if (!snap.exists()) {
    contentArea.innerHTML = "<p>物件情報が見つかりません。</p>";
    return;
  }

  const data = snap.data();
  const title = data.canonicalName || "物件";

  document.getElementById("propertyTitle").textContent = title;
  document.getElementById("propertyMetaSection").classList.remove("hidden");
  document.getElementById("propertyMeta").textContent = data.address || "";

  document.title = `${title}の入居のしおり｜ユニヴ・ライフ株式会社`;

  let metaDesc = document.querySelector('meta[name="description"]');
  metaDesc.content =
    `${title}の入居のしおりです。` +
    `ゴミ出し方法、インターネット、設備利用方法、注意事項などを掲載しています。`;

  let canonical = document.createElement("link");
  canonical.rel = "canonical";
  canonical.href = `https://guide.univ-life.com/?propertyNo=${propertyNo}`;
  document.head.appendChild(canonical);

  contentArea.innerHTML = `
    <section class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
      <p class="text-sm text-slate-700">
        入居に関する各種ご案内を掲載しています。
      </p>
    </section>
  `;
}
</script>

</body>
</html>
