<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>入居直後アンケート | UNIV LIFE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-50 text-slate-900 min-h-screen flex items-center justify-center">

  <div class="w-full max-w-md bg-white rounded-2xl shadow-sm p-6 space-y-5">

    <h1 class="text-base font-semibold text-slate-800">
      ご入居直後アンケート（1分）
    </h1>

    <div id="msg"
      class="hidden rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-xs text-slate-700">
    </div>

    <!-- フォーム -->
    <form id="surveyForm" class="space-y-6">

      <!-- Q1 -->
      <div>
        <p class="text-sm font-medium">① お部屋の状態はいかがでしたか？</p>
        <div class="mt-2 space-y-2 text-sm">
          <label class="flex items-center border rounded-lg px-3 py-2">
            <input type="radio" name="room" value="5" class="mr-2"> ★★★★★ とても満足
          </label>
          <label class="flex items-center border rounded-lg px-3 py-2">
            <input type="radio" name="room" value="4" class="mr-2"> ★★★★☆ 満足
          </label>
          <label class="flex items-center border rounded-lg px-3 py-2">
            <input type="radio" name="room" value="3" class="mr-2"> ★★★☆☆ ふつう
          </label>
          <label class="flex items-center border rounded-lg px-3 py-2">
            <input type="radio" name="room" value="2" class="mr-2"> ★★☆☆☆ やや不満
          </label>
          <label class="flex items-center border rounded-lg px-3 py-2">
            <input type="radio" name="room" value="1" class="mr-2"> ★☆☆☆☆ 不満
          </label>
        </div>
      </div>

      <!-- Q2 -->
      <div>
        <p class="text-sm font-medium">② 管理会社・入居のしおりはいかがでしたか？</p>
        <div class="mt-2 space-y-2 text-sm">
          <label class="flex items-center border rounded-lg px-3 py-2">
            <input type="radio" name="management" value="5" class="mr-2"> ★★★★★ とても満足
          </label>
          <label class="flex items-center border rounded-lg px-3 py-2">
            <input type="radio" name="management" value="4" class="mr-2"> ★★★★☆ 満足
          </label>
          <label class="flex items-center border rounded-lg px-3 py-2">
            <input type="radio" name="management" value="3" class="mr-2"> ★★★☆☆ ふつう
          </label>
          <label class="flex items-center border rounded-lg px-3 py-2">
            <input type="radio" name="management" value="2" class="mr-2"> ★★☆☆☆ やや不満
          </label>
          <label class="flex items-center border rounded-lg px-3 py-2">
            <input type="radio" name="management" value="1" class="mr-2"> ★☆☆☆☆ 不満
          </label>
        </div>
      </div>

      <!-- コメント -->
      <div>
        <p class="text-sm font-medium">③ 気になった点（任意）</p>
        <textarea id="comment"
          class="mt-2 w-full rounded-lg border p-2 text-sm"
          rows="3"
          placeholder="ご自由にご記入ください"></textarea>
      </div>

      <!-- 送信 -->
      <button type="button" id="submitBtn"
        class="w-full rounded-lg bg-emerald-600 text-white py-2 text-sm font-semibold">
        送信
      </button>

    </form>
  </div>

  <!-- ================= Firebase compat（module不使用） ================= -->

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // ★ 確認用（これが出なければJS未実行）
    alert("survey.js loaded");

    const firebaseConfig = {
      apiKey: "AIzaSyDneH08GavPizbtH4Oi-RsTrwGerxXWSyQ",
      authDomain: "univlife-kanri.firebaseapp.com",
      projectId: "univlife-kanri"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const msg = document.getElementById("msg");
    const btn = document.getElementById("submitBtn");

    function showMsg(text) {
      msg.textContent = text;
      msg.classList.remove("hidden");
    }

    btn.addEventListener("click", async () => {
      showMsg("送信中…");

      const room = document.querySelector('input[name="room"]:checked');
      const management = document.querySelector('input[name="management"]:checked');

      if (!room || !management) {
        showMsg("①②は必須です");
        return;
      }

      try {
        await db.collection("movein_survey").add({
          room_score: Number(room.value),
          management_score: Number(management.value),
          comment: document.getElementById("comment").value || "",
          created_at: firebase.firestore.FieldValue.serverTimestamp()
        });

        showMsg("送信が完了しました。ご協力ありがとうございます。");

      } catch (e) {
        console.error(e);
        showMsg("送信に失敗しました：" + e.message);
      }
    });
  </script>

</body>
</html>
