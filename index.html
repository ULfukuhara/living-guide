<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>入居のしおり | guide.univ-life.com</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col">
  <!-- Header -->
  <header class="bg-white shadow-sm sticky top-0 z-10">
    <div class="max-w-3xl mx-auto px-4 py-3 flex items-center justify-between">
      <div>
        <h1 id="propertyTitle" class="text-lg font-semibold text-slate-800">物件名を読み込み中…</h1>
        <p id="propertyNo" class="text-xs text-slate-500"></p>
      </div>
      <span class="text-xs px-2 py-1 rounded-full bg-indigo-50 text-indigo-700">入居のしおり</span>
    </div>
  </header>

  <!-- Main -->
  <main class="flex-1 max-w-3xl mx-auto w-full px-4 py-6 space-y-4">

    <section id="internetSection" class="hidden bg-white rounded-xl shadow-sm p-4 space-y-1">
      <h2 class="text-sm font-semibold text-indigo-700 flex items-center gap-2">
        <span class="w-1.5 h-4 rounded-full bg-indigo-400 inline-block"></span>
        インターネット・TV
      </h2>
      <p id="internet" class="text-sm text-slate-700 leading-relaxed whitespace-pre-wrap"></p>
    </section>

    <section id="trashSection" class="hidden bg-white rounded-xl shadow-sm p-4 space-y-1">
      <h2 class="text-sm font-semibold text-amber-700 flex items-center gap-2">
        <span class="w-1.5 h-4 rounded-full bg-amber-400 inline-block"></span>
        ごみ出しについて
      </h2>
      <p id="trash" class="text-sm text-slate-700 leading-relaxed whitespace-pre-wrap"></p>
    </section>

    <section id="bicycleSection" class="hidden bg-white rounded-xl shadow-sm p-4 space-y-1">
      <h2 class="text-sm font-semibold text-emerald-700 flex items-center gap-2">
        <span class="w-1.5 h-4 rounded-full bg-emerald-400 inline-block"></span>
        駐輪場について
      </h2>
      <p id="bicycle" class="text-sm text-slate-700 leading-relaxed whitespace-pre-wrap"></p>
    </section>

    <section id="otherSection" class="hidden bg-white rounded-xl shadow-sm p-4 space-y-1">
      <h2 class="text-sm font-semibold text-slate-700 flex items-center gap-2">
        <span class="w-1.5 h-4 rounded-full bg-slate-400 inline-block"></span>
        その他のルール・お願い
      </h2>
      <p id="other" class="text-sm text-slate-700 leading-relaxed whitespace-pre-wrap"></p>
    </section>

    <section id="contactSection" class="hidden bg-white rounded-xl shadow-sm p-4 space-y-1">
      <h2 class="text-sm font-semibold text-rose-700 flex items-center gap-2">
        <span class="w-1.5 h-4 rounded-full bg-rose-400 inline-block"></span>
        連絡先
      </h2>
      <div class="text-sm text-slate-700 space-y-1">
        <p>管理会社：<span id="management_contact" class="font-medium"></span></p>
        <p>緊急時連絡先：<span id="emergency_contact" class="font-medium"></span></p>
      </div>
    </section>

    <p id="status" class="text-xs text-slate-500">Storyblok からデータを取得しています…</p>
  </main>

  <!-- Footer -->
  <footer class="bg-white border-t border-slate-200">
    <div class="max-w-3xl mx-auto px-4 py-3 text-xs text-slate-500 text-center">
      &copy; <span id="year"></span> ユニヴ・ライフ株式会社 管理部
    </div>
  </footer>

  <script>
    // ===== 設定 =====
    const STORYBLOK_TOKEN = "ir2Hm2c38mI69te9Vr92RAtt"; // ← あなたの Public Token に書き換え
    const DEFAULT_SLUG = "demo-guide"; // Storyblokのスラッグ（例：P0001用に変えてOK）

    document.getElementById("year").textContent = new Date().getFullYear();

    function getParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    function showSection(id, text) {
      if (text) {
        document.getElementById(id).textContent = text;
        document.getElementById(id + "Section").classList.remove("hidden");
      }
    }

    async function main() {
      const propertyNo = getParam("propertyNo") || DEFAULT_SLUG;
      document.getElementById("propertyNo").textContent = "物件No：" + propertyNo;

      try {
        const url = new URL("https://api.storyblok.com/v2/cdn/stories/" + propertyNo);
        url.searchParams.set("token", STORYBLOK_TOKEN);
        url.searchParams.set("version", "published");
        url.searchParams.set("cv", Date.now().toString());

        const res = await fetch(url.toString());
        if (!res.ok) throw new Error("Storyblok API エラー: " + res.status);

        const data = await res.json();
        const c = data.story?.content;
        if (!c) throw new Error("該当する物件情報が見つかりません");

        // 表示
        document.getElementById("propertyTitle").textContent = c.title || data.story.name;
        showSection("internet", c.internet);
        showSection("trash", c.trash);
        showSection("bicycle", c.bicycle);
        showSection("other", c.other);

        if (c.management_contact || c.emergency_contact) {
          if (c.management_contact)
            document.getElementById("management_contact").textContent = c.management_contact;
          if (c.emergency_contact)
            document.getElementById("emergency_contact").textContent = c.emergency_contact;
          document.getElementById("contactSection").classList.remove("hidden");
        }

        document.getElementById("status").textContent = "最新のデータを表示しています。";
      } catch (e) {
        console.error(e);
        document.getElementById("status").textContent =
          "データ取得に失敗しました：" + e.message;
        document.getElementById("status").classList.add("text-red-600");
      }
    }

    main();
  </script>
</body>
</html>
